<!DOCTYPE html>
<html>
<head>
    <title>MiniPlayerApp</title>
    <link rel='stylesheet' href='/css/index.css' />
</head>
<body>
<%- include('./common/navbar.ejs') %>
<h1 style="text-align: center;">Songs</h1>
<section style="margin-left: 16px;">
    <%- include('./common/songsList.ejs', {items}) %>
    <h3 style="text-align: center;"><span class="white-text">Upload a new song:</span></h3>
    <div class="container">
        <div class="form-container">
            <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
                <input type="file" name="file" required>
                <select name="category">
                    <option value="rock">Rock</option>
                    <option value="pop">Pop</option>
                    <option value="jazz">Jazz</option>
                    <option value="classical">Classical</option>
                </select>
                <input type="text" name="title" id="songTitle" placeholder="Song title" required>
                <input type="text" name="author" id="songAuthor" placeholder="Song author" required>
                <button type="submit">Upload</button>
            </form>
            <div id="progress-container">
                <div id="progress-bar">0%</div>
            </div>
        </div>
    </div>
</section>
<script>
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);

        const xhr = new XMLHttpRequest();
        xhr.open('POST', form.action, true);

        xhr.upload.addEventListener('progress', function(e) {
            if (e.lengthComputable) {
                const percentComplete = (e.loaded / e.total) * 100;
                const progressBar = document.getElementById('progress-bar');
                progressBar.style.width = percentComplete + '%';
                progressBar.textContent = Math.round(percentComplete) + '%';
            }
        });

        xhr.addEventListener('load', function() {
            if (xhr.status === 200) {
                alert('Upload complete!');
            } else {
                alert('Upload failed!');
            }
        });

        xhr.send(formData);
    });
</script>
</body>
</html>
